provider "random" {
  version = "~>2.2"
}

resource "random_string" "main" {
  length  = 60
  special = false
  upper   = false
  number  = var.unique-include-numbers
}

resource "random_string" "first_letter" {
  length  = 1
  special = false
  upper   = false
  number  = false
}



locals {
  // adding a first letter to guarantee that you always start with a letter
  random_safe_generation = join("", [random_string.first_letter.result, random_string.main.result])
  random                 = substr(coalesce(var.unique-seed, local.random_safe_generation), 0, var.unique-length)
  prefix                 = join("-", var.prefix)
  prefix_safe            = lower(join("", var.prefix))
  suffix                 = join("-", var.suffix)
  suffix_unique          = join("-", concat(var.suffix, [local.random]))
  suffix_safe            = lower(join("", var.suffix))
  suffix_unique_safe     = lower(join("", concat(var.suffix, [local.random])))
  // Names based in the recomendations of
  // https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging
  az = {
    analysis_services_server                           = "as"
    api_managment_service                              = "apim"
    app_configuration                                  = "appcg"
    role_assignment                                    = "ra"
    role_definition                                    = "rd"
    automation_account                                 = "aa"
    automation_certificate                             = "aacert"
    automation_credential                              = "aacred"
    automation_runbook                                 = "aacred"
    automation_schedule                                = "aasched"
    automation_variable                                = "aavar"
    batch_account                                      = "ba"
    batch_application                                  = "baapp"
    batch_certificate                                  = "bacert"
    batch_pool                                         = "bapool"
    bot_web_app                                        = "bot"
    bot_channel_Email                                  = "botmail"
    bot_channel_ms_teams                               = "botteams"
    bot_channel_slack                                  = "botslack"
    bot_channel_directline                             = "botline"
    bot_channels_registration                          = "botchan"
    bot_connection                                     = "botcon"
    redis_cache                                        = "redis"
    redis_firewall_rule                                = "redisfw"
    cdn_profile                                        = "cdnprof"
    cdn_endpoint                                       = "cdn"
    cognitive_account                                  = "cog"
    availability_set                                   = "avail"
    disk_encryption_set                                = "des"
    image                                              = "img"
    linux_virtual_machine                              = "vm"
    linux_virtual_machine_scale_set                    = "vmss"
    managed_disk                                       = "dsk"
    virtual_machine                                    = "vm"
    virtual_machine_scale_set                          = "vmss"
    windows_virtual_machine                            = "vm"
    windows_virtual_machine_scale_set                  = "vmss"
    containerGroups                                    = "cg"
    container_registry                                 = "cr"
    container_registry_webhook                         = "crwh"
    kubernetes_cluster                                 = "aks"
    cosmosdb_account                                   = "cosmos"
    custom_provider                                    = "prov"
    mariadb_server                                     = "maria"
    mariadb_firewall_rule                              = "mariafw"
    mariadb_database                                   = "mariadb"
    mariadb_virtual_network_rule                       = "mariavn"
    mysql_server                                       = "mysql"
    mysql_firewall_rule                                = "mysqlfw"
    mysql_database                                     = "mysqldb"
    mysql_virtual_network_rule                         = "mysqlvn"
    postgresql_server                                  = "psql"
    postgresql_firewall_rule                           = "psqlfw"
    postgresql_database                                = "psqldb"
    postgresql_virtual_network_rule                    = "psqlvn"
    database_migration_project                         = "migr"
    database_migration_service                         = "dms"
    databricks_workspace                               = "dbw"
    kusto_cluster                                      = "kc"
    kusto_database                                     = "kdb"
    kusto_eventhub_data_connection                     = "kehc"
    data_factory                                       = "adf"
    data_factory_dataset_mysql                         = "adfmysql"
    data_factory_dataset_postgresql                    = "adfpsql"
    data_factory_dataset_sql_server_table              = "adfmssql"
    data_factory_integration_runtime_managed           = "adfir"
    data_factory_pipeline                              = "adfpl"
    data_factory_linked_service_data_lake_storage_gen2 = "adfsvst"
    data_factory_linked_service_key_vault              = "adfsvkv"
    data_factory_linked_service_mysql                  = "adfsvmysql"
    data_factory_linked_service_postgresql             = "adfsvpsql"
    data_factory_linked_service_sql_server             = "adfsvmssql"
    data_factory_trigger_schedule                      = "adftg"
    data_lake_analytics_account                        = "dla"
    data_lake_analytics_firewall_rule                  = "dlfw"
    data_lake_store                                    = "dls"
    data_lake_store_firewall_rule                      = "dlsfw"
    dev_test_lab                                       = "lab"
    dev_test_linux_virtual_machine                     = "labvm"
    dev_test_windows_virtual_machine                   = "labvm"
    frontdoor                                          = "fd"
    frontdoor_firewall_policy                          = "fdfw"
    hdinsight_hadoop_cluster                           = "hadoop"
    hdinsight_hbase_cluster                            = "hbase"
    hdinsight_kafka_cluster                            = "kafka"
    hdinsight_interactive_query_cluster                = "iqr"
    hdinsight_ml_services_cluster                      = "mls"
    hdinsight_rserver_cluster                          = "rsv"
    hdinsight_spark_cluster                            = "spark"
    hdinsight_storm_cluster                            = "storm"
    iotcentral_application                             = "iotapp"
    iothub                                             = "iot"
    iothub_consumer_group                              = "iotcg"
    iothub_dps                                         = "dps"
    iothub_dps_certificate                             = "dpscert"
    key_vault                                          = "kv"
    key_vault_key                                      = "kvk"
    key_vault_secret                                   = "kvs"
    key_vault_certificate                              = "kvc"
    lb                                                 = "lb"
    lb_nat_rule                                        = "lbnatrl"
    public_ip                                          = "pip"
    public_ip_prefix                                   = "pippf"
    route                                              = "rt"
    route_table                                        = "route"
    subnet                                             = "snet"
    traffic_manager_profile                            = "traf"
    virtual_wan                                        = "vwan"
    virtual_network                                    = "vnet"
    virtual_network_gateway                            = "vgw"
    virtual_network_peering                            = "vpeer"
    network_interface                                  = "nic"
    firewall                                           = "fw"
    eventhub                                           = "evh"
    eventhub_namespace                                 = "ehn"
    eventhub_authorization_rule                        = "ehar"
    eventhub_namespace_authorization_rule              = "ehnar"
    eventhub_namespace_disaster_recovery_config        = "ehdr"
    eventhub_consumer_group                            = "ehcg"
    stream_analytics_job                               = "asa"
    stream_analytics_function_javascript_udf           = "asafunc"
    stream_analytics_output_blob                       = "asaoblob"
    stream_analytics_output_mssql                      = "asaomssql"
    stream_analytics_output_eventhub                   = "asaoeh"
    stream_analytics_output_servicebus_queue           = "asaosbq"
    stream_analytics_output_servicebus_topic           = "asaosbt"
    stream_analytics_reference_input_blob              = "asarblob"
    stream_analytics_stream_input_blob                 = "asaiblob"
    stream_analytics_stream_input_eventhub             = "asaieh"
    stream_analytics_stream_input_iothub               = "asaiiot"
    shared_image_gallery                               = "sig"
    shared_image                                       = "si"
    snapshots                                          = "snap"
    storage_account                                    = "st"
    storage_container                                  = "stct"
    storage_data_lake_gen2_filesystem                  = "stdl"
    storage_queue                                      = "stq"
    storage_table                                      = "stt"
    storage_share                                      = "sts"
    storage_share_directory                            = "sts"
    machine_learning_workspace                         = "mlw"
    storage_blob                                       = "blob"
    bastion_host                                       = "snap"
    local_network_gateway                              = "lgw"
    application_gateway                                = "agw"
    express_route_gateway                              = "ergw"
    express_route_circuit                              = "erc"
    point_to_site_vpn_gateway                          = "vpngw"
    template_deployment                                = "deploy"
    sql_server                                         = "sql"
    mssql_server                                       = "sql"
    mssql_database                                     = "sqldb"
    sql_elasticpool                                    = "sqlep"
    mssql_elasticpool                                  = "sqlep"
    sql_failover_group                                 = "sqlfg"
    sql_firewall_rule                                  = "sqlfw"
    log_analytics_workspace                            = "log"
    service_fabric_cluster                             = "sf"
    maps_account                                       = "map"
    network_watcher                                    = "nw"
  }
}
